#include <Main.h>
/*********************************DEF************************************/
#define weel_s 1 //轮子的周长
#define weel_n 2 //传动比

#define TIME3_ENABLE	TIM_Cmd(TIM3,ENABLE)
#define TIME3_DISABLE	TIM_Cmd(TIM3,DISABLE)
///*************************************************************************/
unsigned char data_buf[14]={0};
unsigned char send_buf[30]={0};

int flag_sent_usart = 0;
int Key_1=0;
int Key_2=0;
int Key_3=0;
int Key_1_his=0;
int Key_2_his=0;
int Key_3_his=0;
int Mode_Speed=0;
int Mode_Speed_his = 0;

unsigned char dismode[10] = {0};
int speed_level = 0;
int speed_level_his = 100;
unsigned char disspeed[10] = {0};



int power_level = 0;
int power_level_his = 100;
unsigned char dispower[10] = {0};



int Stop_1 = 0;
int Stop_2 = 0;











/*-------------16x16??----------------*/
/*=============????????,????50%================*/
unsigned char Dianchi_2_50_UP[]={
0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??100%================*/
unsigned char Dianchi_1_100[]={
0x00,0x00,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x00,0x00,
};
/*=============????????,??90%================*/
unsigned char Dianchi_1_90[]={
0x00,0x00,0x0F,0xFF,0x09,0xFF,0x09,0xFF,0x09,0xFF,0xF9,0xFF,0x81,0xFF,0x81,0xFF,
0x81,0xFF,0x81,0xFF,0xF9,0xFF,0x09,0xFF,0x09,0xFF,0x09,0xFF,0x0F,0xFF,0x00,0x00,
};
/*=============????????,??80%================*/
unsigned char Dianchi_1_80[]={
0x00,0x00,0x0F,0xFF,0x08,0x3F,0x08,0x3F,0x08,0x3F,0xF8,0x3F,0x80,0x3F,0x80,0x3F,
0x80,0x3F,0x80,0x3F,0xF8,0x3F,0x08,0x3F,0x08,0x3F,0x08,0x3F,0x0F,0xFF,0x00,0x00,
};
/*=============????????,??70%================*/
unsigned char Dianchi_1_70[]={
0x00,0x00,0x0F,0xFF,0x08,0x07,0x08,0x07,0x08,0x07,0xF8,0x07,0x80,0x07,0x80,0x07,
0x80,0x07,0x80,0x07,0xF8,0x07,0x08,0x07,0x08,0x07,0x08,0x07,0x0F,0xFF,0x00,0x00,
};
/*=============????????,??60%================*/
unsigned char Dianchi_1_60[]={
0x00,0x00,0x0F,0xFF,0x08,0x01,0x08,0x01,0x08,0x01,0xF8,0x01,0x80,0x01,0x80,0x01,
0x80,0x01,0x80,0x01,0xF8,0x01,0x08,0x01,0x08,0x01,0x08,0x01,0x0F,0xFF,0x00,0x00,
};

/*=============????????,????50%================*/
unsigned char Dianchi_1_50_DOWN[]={
0x00,0x00,0x0F,0xFF,0x08,0x00,0x08,0x00,0x08,0x00,0xF8,0x00,0x80,0x00,0x80,0x00,
0x80,0x00,0x80,0x00,0xF8,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x0F,0xFF,0x00,0x00,
};
/*=============????????,??50%================*/
unsigned char Dianchi_2_50[]={
0x00,0x00,0xFF,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,
0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0x3F,0xFF,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??40%================*/
unsigned char Dianchi_2_40[]={
0x00,0x00,0xFF,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,
0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??30%================*/
unsigned char Dianchi_2_30[]={
0x00,0x00,0xFF,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,
0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??20%================*/
unsigned char Dianchi_2_20[]={
0x00,0x00,0xFF,0xFF,0x70,0x7F,0x70,0x7F,0x70,0x7F,0x70,0x7F,0x70,0x7F,0x70,0x7F,
0x70,0x7F,0x70,0x7F,0x00,0x7F,0x70,0x7F,0x70,0x7F,0x70,0x7F,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??10%================*/
unsigned char Dianchi_2_10[]={
0x00,0x00,0xFF,0xFF,0x70,0x0F,0x70,0x0F,0x70,0x0F,0x70,0x0F,0x70,0x0F,0x70,0x0F,
0x70,0x0F,0x70,0x0F,0x00,0x0F,0x70,0x0F,0x70,0x0F,0x70,0x0F,0xFF,0xFF,0x00,0x00,
};
/*=============????????,??0%================*/
unsigned char Dianchi_2_0[]={
0x00,0x00,0xFF,0xFF,0x70,0x01,0x70,0x01,0x70,0x01,0x70,0x01,0x70,0x01,0x70,0x01,
0x70,0x01,0x70,0x01,0x00,0x01,0x70,0x01,0x70,0x01,0x70,0x01,0xFF,0xFF,0x00,0x00,
};

////////////////////////////////////////////////////////////////////////////////////////
/*-------------?????----------------*/
unsigned char dianliang_100[]={//=====100%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x23,0x18,0x64,0xA4,0x24,0xA4,0x24,0xA4,
0x24,0xA4,0x24,0xA4,0x24,0xA4,0x73,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_90[]={//=====90%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x18,0x04,0xA4,0x04,0xA4,0x03,0xA4,
0x00,0xA4,0x04,0xA4,0x04,0xA4,0x03,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
unsigned char dianliang_80[]={//=====80%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x18,0x04,0xA4,0x04,0xA4,0x03,0x24,
0x03,0x24,0x04,0xA4,0x04,0xA4,0x03,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_70[]={//=====70%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x98,0x00,0xA4,0x00,0xA4,0x01,0xA4,
0x03,0x24,0x02,0x24,0x02,0x24,0x02,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
unsigned char dianliang_60[]={//=====60%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x18,0x04,0xA4,0x04,0x24,0x07,0x24,
0x04,0xA4,0x04,0xA4,0x04,0xA4,0x03,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_50[]={//=====50%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x98,0x04,0x24,0x07,0x24,0x03,0xA4,
0x00,0xA4,0x00,0xA4,0x04,0xA4,0x03,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_40[]={//=====40%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x18,0x03,0x24,0x05,0x24,0x05,0x24,
0x0F,0xA4,0x01,0x24,0x01,0x24,0x01,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
unsigned char dianliang_30[]={//=====30%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x18,0x04,0xA4,0x00,0xA4,0x03,0x24,
0x03,0x24,0x00,0xA4,0x04,0xA4,0x03,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_20[]={//=====20%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x18,0x04,0xA4,0x00,0xA4,0x00,0xA4,
0x01,0xA4,0x03,0x24,0x06,0x24,0x07,0x98,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char dianliang_10[]={//=====10%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x18,0x03,0x24,0x01,0x24,0x01,0x24,
0x01,0x24,0x01,0x24,0x01,0x24,0x03,0x98,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
unsigned char dianliang_0[]={//=====0%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x24,0x00,0x24,0x00,0x24,
0x00,0x24,0x00,0x24,0x00,0x24,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char percent[]={//=====%======
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x80,0x49,0x00,0x4A,0x00,0x34,0x00,
0x0B,0x00,0x14,0x80,0x24,0x80,0x43,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
////////////////////////////////////////////////////////////////////////////////////////
/*-------------?????----------------*/
unsigned char P_hengxian[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char P_T[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0
};
unsigned char P_xiaT[]={
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
};
unsigned char P_shuxian[]={
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,
0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0,0x07,0xE0
};
unsigned char P_xiahengxian[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};
////////////////////////////////////////////////////////////////////////////////////////
/*-------------档位0----------------*/

unsigned char Dangwei_0_1[]={
0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0
};
unsigned char Dangwei_0_2[]={
0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0
};
unsigned char Dangwei_0_3[]={
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0
};
unsigned char Dangwei_0_4[]={
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0
};
unsigned char Dangwei_0_5[]={
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F
};

unsigned char Dangwei_0_6[]={
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00
};
/*-------------档位1----------------*/

unsigned char Dangwei_1_1[]={
0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x01,0xFF,0x01,0xFF,
0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07
};
unsigned char Dangwei_1_2[]={
0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,
0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00
};
unsigned char Dangwei_1_3[]={
0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,
0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07
};
unsigned char Dangwei_1_4[]={
0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,
0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,
};
unsigned char Dangwei_1_5[]={
0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,0x00,0x07,
0x00,0x07,0x00,0x07,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF,0x01,0xFF
};

unsigned char Dangwei_1_6[]={
0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,
0xE0,0x00,0xE0,0x00,0xFF,0x80,0xFF,0x80,0xFF,0x80,0xFF,0x80,0xFF,0x80,0xFF,0x80
};

/*-------------档位2----------------*/

unsigned char Dangwei_2_1[]={
0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned char Dangwei_2_2[]={
0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0
};
unsigned char Dangwei_2_3[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x3F,
};
unsigned char Dangwei_2_4[]={
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,
0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFC,0x00,0xFC,0x00,
};
unsigned char Dangwei_2_5[]={
0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,
0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,0x0F,0xFF,
};

unsigned char Dangwei_2_6[]={
0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,0xFF,0xF0,
};

/*-------------档位3----------------*/

unsigned char Dangwei_3_1[]={
0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
unsigned char Dangwei_3_2[]={
0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,
};
unsigned char Dangwei_3_3[]={
0x00,0x00,0x00,0x00,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,
0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x00,0x00,0x00,
};
unsigned char Dangwei_3_4[]={
0x03,0xF0,0x03,0xF0,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,
0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0x03,0xF0,0x03,0xF0,
};
unsigned char Dangwei_3_5[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
0x0F,0xC0,0x0F,0xC0,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,0x00,0x3F,
};

unsigned char Dangwei_3_6[]={
0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,0x03,0xF0,
0x03,0xF0,0x03,0xF0,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,0xFC,0x00,
};




unsigned int  bmp3[]={
/*--  ???????:C:\Users\Administrator\Desktop\19296-horse.bmp  --*/
/*--  ??x??=192x96  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x78,0x03,
0x86,0x07,0xCD,0x80,0x00,0x00,0x20,0x00,0x01,0x3F,0xE0,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x03,0x81,0xE0,0x06,0x1C,0x01,0xEC,0x80,0x00,0x08,0x10,0x00,
0x00,0xA0,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x80,0x1C,
0xF0,0x00,0xE6,0x80,0x00,0x05,0xFF,0x80,0x00,0xA5,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x1F,0x06,0x01,0x80,0x00,0xE7,0x80,0x00,0x04,0x48,0x00,
0x04,0x08,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xE6,0x0C,0x00,
0x00,0x01,0xF7,0xC0,0x00,0x20,0x48,0x00,0x02,0x10,0x40,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x1C,0x18,0x00,0x00,0x03,0x12,0xB0,0x00,0x10,0x8F,0x00,
0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x20,0x00,
0x10,0x06,0x03,0x98,0x00,0x10,0x91,0x00,0x00,0x82,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0xF8,0x60,0x00,0x10,0x0E,0x03,0x8C,0x00,0x05,0x99,0x00,
0x00,0xBF,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x07,0x78,0xC0,0x00,
0x20,0x9C,0x3D,0x84,0x00,0x04,0xA5,0x00,0x01,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xF8,0xF0,0x80,0x00,0x43,0xBC,0x02,0xC4,0x00,0x08,0xD2,0x00,
0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x31,0x80,0x00,
0x06,0x78,0x00,0xEC,0x00,0x38,0x92,0x00,0x01,0x0A,0x80,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x7A,0x61,0x00,0x00,0x0C,0xE0,0x00,0xBC,0x00,0x08,0x8C,0x00,
0x01,0x12,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xE0,0x00,0x00,
0x19,0xC0,0x00,0x9C,0x00,0x08,0x88,0x00,0x01,0x62,0x30,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x06,0x1F,0xC2,0x00,0x00,0x3F,0x80,0xE0,0x9C,0x00,0x08,0x94,0x00,
0x01,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xE7,0xC4,0x00,0x02,
0x7E,0x01,0xF9,0x9C,0x00,0x08,0xA2,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x08,0xC0,0x00,0x00,0x7C,0x06,0x42,0x8C,0x00,0x00,0xC1,0x80,
0x00,0x88,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x51,0x84,0x00,0x20,
0xF8,0x03,0xC2,0x9C,0x00,0x03,0xF8,0x00,0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x23,0x84,0x00,0x22,0xE0,0x03,0xC5,0x1C,0x00,0x02,0x08,0x00,
0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0xC7,0x88,0x00,0x26,
0xE0,0x01,0x81,0x08,0x00,0x02,0x08,0x00,0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x07,0x09,0x08,0x00,0x24,0xE0,0x00,0x03,0x30,0x00,0x03,0xF8,0x00,
0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x13,0x08,0x00,0x38,
0xB0,0x00,0x02,0x00,0x00,0x02,0x08,0x00,0x07,0xE9,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x72,0x00,0x00,0x30,0xB0,0x00,0x02,0x00,0x00,0x02,0x08,0x00,
0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x82,0x00,0x00,0x20,
0x98,0x04,0x06,0x00,0x00,0x03,0xF8,0x00,0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x20,0x9C,0x08,0x04,0x00,0x00,0x00,0x00,0x00,
0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x3C,0x00,0x00,0x20,
0xCC,0x08,0x04,0x00,0x00,0x1F,0xBF,0x00,0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0xEC,0x00,0x00,0x20,0x4C,0x10,0x0C,0x00,0x00,0x10,0xA1,0x00,
0x00,0x89,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x00,0x30,
0x4C,0x20,0x08,0x00,0x00,0x10,0xA1,0x00,0x00,0xE9,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x02,0x18,0x00,0x00,0x10,0x4C,0x00,0x08,0x00,0x00,0x1F,0xBF,0x00,
0x07,0x09,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xF8,0x00,0x00,0x00,
0x4C,0x00,0x08,0x00,0x00,0x10,0xA1,0x00,0x02,0x11,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x6C,0x00,0x18,0x00,0x00,0x10,0xA1,0x00,
0x00,0x10,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,
0x6C,0x01,0x30,0x00,0x00,0x1F,0xBF,0x00,0x00,0x20,0x20,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x66,0x03,0x30,0x00,0x00,0x10,0xA1,0x00,
0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,
0x6E,0x02,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x80,0x00,0x00,0x00,0x2F,0x42,0x30,0x00,0x00,0x07,0xFC,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x00,0x00,0x00,
0x3B,0x24,0x20,0x00,0x00,0x04,0x04,0x00,0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x3B,0x98,0x60,0x00,0x00,0x04,0x04,0x00,
0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x00,0x00,0x00,0x00,
0x33,0x94,0x40,0x00,0x00,0x07,0xFC,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x33,0xAC,0x40,0x00,0x00,0x04,0x04,0x00,
0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xE0,0x00,0x00,0x00,0x00,
0x33,0x8F,0xC0,0x00,0x00,0x04,0x04,0x00,0x01,0xFF,0xC0,0x00,0x00,0x00,0x00,0x7F,
0xFE,0x01,0xFC,0x00,0x00,0x00,0x00,0x50,0x3F,0x97,0x80,0x00,0x00,0x07,0xFC,0x00,
0x01,0x08,0x40,0x00,0x00,0x00,0x03,0xF0,0x07,0xFF,0xC0,0x00,0x00,0x00,0x00,0x30,
0x3F,0x97,0x00,0x00,0x00,0x01,0x10,0x00,0x01,0x08,0x40,0x00,0x00,0x00,0x0F,0x80,
0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x30,0x11,0x9F,0x00,0x00,0x00,0x11,0x11,0x00,
0x01,0x08,0x40,0x00,0x00,0x00,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,
0x11,0x9C,0x00,0x00,0x00,0x09,0x11,0x00,0x01,0x08,0x40,0x00,0x00,0x00,0x78,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0xF0,0x00,0x00,0x00,0x05,0x12,0x00,
0x01,0x09,0x40,0x00,0x01,0xFF,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x28,
0x10,0x00,0xFC,0x00,0x00,0x05,0x14,0x00,0x01,0x08,0x80,0x00,0x01,0x01,0xC0,0x00,
0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x04,0x10,0x03,0x8E,0x00,0x00,0x01,0x10,0x00,
0x00,0x08,0x00,0x00,0x06,0x3F,0x80,0x00,0x00,0x00,0x00,0x00,0x01,0x80,0x00,0x04,
0x10,0x06,0x06,0x00,0x00,0x3F,0xFF,0x80,0x00,0x08,0x00,0x00,0x0D,0xC6,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0x80,0x00,0x06,0x18,0x1C,0x02,0x00,0x00,0x00,0x00,0x00,
0x00,0x7F,0x00,0x00,0x12,0x8E,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x80,0x00,0x04,
0x58,0x70,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x00,0x00,0x15,0x1C,0x00,0x00,
0x30,0x00,0x00,0x00,0x00,0x40,0x00,0x08,0x53,0xC0,0x06,0x00,0x00,0x0F,0xFE,0x00,
0x00,0x41,0x00,0x00,0x2A,0x38,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x20,0x00,0x0A,
0x5F,0x70,0xF4,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x22,0x58,0x00,0x00,
0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x41,0x8F,0xF4,0x00,0x00,0x00,0x00,0x00,
0x00,0x41,0x00,0x00,0x52,0x58,0x00,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,
0x06,0x07,0x74,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x00,0x00,0x56,0x58,0x00,0x00,
0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x34,0x18,0x23,0x78,0x00,0x00,0x00,0x00,0x00,
0x00,0x7F,0x00,0x00,0x46,0x58,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x10,0x00,0x00,
0xE0,0x03,0x78,0x00,0x00,0x3F,0xFF,0x80,0x00,0x00,0x00,0x00,0x54,0x58,0x00,0x00,
0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x00,0x03,0x78,0x00,0x00,0x00,0x40,0x00,
0x03,0xF7,0xE0,0x00,0x44,0x58,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xF2,0x78,0x00,0x00,0x00,0x40,0x00,0x02,0x14,0x20,0x00,0x54,0x58,0x00,0x00,
0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xF2,0x78,0x00,0x00,0x04,0x44,0x00,
0x02,0x14,0x20,0x00,0x54,0x58,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x07,0x36,0x78,0x00,0x00,0x04,0x42,0x00,0x03,0xF7,0xE0,0x00,0x54,0x48,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x80,0x0E,0x36,0xF8,0x00,0x00,0x08,0x41,0x00,
0x02,0x14,0x20,0x00,0x54,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x00,
0x9C,0x3C,0xD8,0x00,0x00,0x10,0x40,0x80,0x02,0x14,0x20,0x00,0x52,0x48,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x30,0x7C,0xD0,0x00,0x00,0x20,0x40,0x80,
0x03,0xF7,0xE0,0x00,0x32,0x48,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
0x60,0x7C,0x90,0x00,0x00,0x01,0x40,0x00,0x02,0x14,0x20,0x00,0x3A,0x4C,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x70,0xC0,0x7D,0x90,0x00,0x00,0x00,0x80,0x00,
0x00,0x04,0x40,0x00,0x2A,0x4C,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xF0,0x03,
0x80,0x7F,0x10,0x00,0x00,0x04,0x44,0x00,0x07,0xE2,0x40,0x00,0x2A,0x4C,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x03,0xF8,0x0E,0x00,0x6B,0x10,0x00,0x00,0x04,0x44,0x00,
0x02,0x42,0x80,0x00,0x2A,0x4C,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xFC,0xF8,
0x00,0x6B,0x30,0x00,0x00,0x05,0xFF,0x00,0x02,0x40,0x00,0x00,0x2A,0x8C,0x40,0x00,
0x04,0x00,0x00,0x00,0x00,0x0E,0x07,0xC0,0x00,0xCB,0x20,0x00,0x00,0x04,0x44,0x00,
0x03,0xCF,0xE0,0x00,0x3A,0xC8,0x40,0x00,0x0C,0x00,0x00,0x00,0x00,0x18,0x00,0x00,
0x00,0xCA,0x40,0x00,0x00,0x3F,0x00,0x00,0x02,0x41,0x00,0x00,0x32,0x88,0x20,0x00,
0x0C,0x00,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x8E,0xC0,0x00,0x00,0x04,0xFE,0x00,
0x02,0x41,0x00,0x00,0x72,0x98,0x00,0x00,0x18,0x00,0x00,0x00,0x03,0xC0,0x00,0x00,
0x01,0x9C,0x80,0x00,0x00,0x0C,0x82,0x00,0x03,0xC1,0x00,0x00,0x73,0x18,0x00,0x00,
0x1E,0x00,0x00,0x00,0x1E,0x00,0x00,0x00,0x01,0x9C,0x80,0x00,0x00,0x0E,0xFE,0x00,
0x02,0x5F,0xF0,0x00,0x67,0x18,0x00,0x00,0x37,0xC0,0x00,0x00,0x78,0x00,0x00,0x00,
0x01,0x99,0x80,0x00,0x00,0x15,0x82,0x00,0x02,0x41,0x00,0x00,0xE6,0x18,0x00,0x00,
0x31,0xFE,0x00,0x0F,0xC0,0x00,0x00,0x00,0x01,0x3B,0x80,0x00,0x00,0x14,0xFE,0x00,
0x02,0x62,0x80,0x00,0xC6,0x18,0x00,0x00,0x60,0x7F,0xFF,0xFE,0x00,0x00,0x00,0x00,
0x0F,0x31,0x00,0x00,0x00,0x24,0x10,0x00,0x03,0xC2,0x80,0x00,0xCC,0x10,0x00,0x28,
0xE0,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x73,0x00,0x00,0x00,0x05,0xFF,0x00,
0x06,0x44,0x40,0x00,0x90,0x10,0x00,0x09,0xC0,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
0x18,0xD2,0x00,0x00,0x00,0x04,0x28,0x00,0x00,0x44,0x40,0x01,0x80,0x30,0x00,0x11,
0x80,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0xCE,0x00,0x00,0x00,0x04,0x44,0x00,
0x00,0x48,0x20,0x01,0x00,0x30,0x00,0x23,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,
0x4C,0x8E,0x00,0x00,0x00,0x04,0x82,0x00,0x00,0x50,0x10,0x03,0x00,0x30,0x40,0x06,
0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x47,0x84,0x00,0x00,0x00,0x05,0x01,0x80,
0x00,0x00,0x00,0x02,0x00,0x30,0x30,0x0C,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
0x43,0x00,0x00,0x00,0x00,0x04,0x10,0x00,0x01,0x3F,0x80,0x00,0x00,0x30,0x00,0x1C,
0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x00,0x00,0x00,0x00,0x04,0x10,0x00,
0x00,0x88,0x80,0x00,0x00,0x20,0x00,0x38,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x22,0x00,0x00,0x00,0x00,0x04,0x10,0x00,0x00,0x88,0x80,0x00,0x00,0x20,0x00,0x70,
0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x22,0x00,0x00,0x00,0x00,0x04,0xFF,0x00,
0x00,0x08,0x80,0x00,0x00,0x40,0x00,0xC0,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x14,0x00,0x00,0x00,0x00,0x04,0x11,0x00,0x00,0x08,0x80,0x00,0x00,0xC0,0x03,0x80,
0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x00,0x00,0x00,0x00,0x3F,0x11,0x00,
0x07,0x88,0x80,0x00,0x01,0x00,0x0F,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x08,0x00,0x00,0x00,0x00,0x04,0x11,0x00,0x00,0xBE,0x80,0x00,0x06,0x00,0x0C,0x03,
0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x11,0x00,
0x00,0x88,0x80,0x00,0x04,0x00,0x18,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x04,0xFF,0x80,0x00,0x88,0x80,0x00,0x0C,0x00,0x69,0x08,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x10,0x00,
0x00,0x88,0x80,0x00,0x18,0x00,0xDA,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x04,0x28,0x00,0x00,0x88,0x90,0x00,0x10,0x01,0x92,0x60,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x28,0x00,
0x00,0xA8,0x50,0x00,0x10,0x03,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x00,0x00,0xC8,0x50,0x00,0x10,0x06,0x21,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x82,0x00,
0x00,0x88,0x30,0x00,0x10,0x0C,0x23,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x08,0x10,0x00,0x10,0x08,0x22,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x80,
};






/*********************************GPIO************************************/
void GPIO_Control_Init()
{
	//GPIO_InitTypeDef type;
	
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOD|RCC_APB2Periph_GPIOC
												|RCC_APB2Periph_GPIOB|RCC_APB2Periph_GPIOA
												|RCC_APB2Periph_AFIO, ENABLE);
}

/*********************************TIMER************************************/
void Timer_Config(void)
{
	TIM_TimeBaseInitTypeDef tim;
	NVIC_InitTypeDef NVIC_InitStructure;
	
	
	//TIM3 used to calculate speed, generate control update cycle
  NVIC_InitStructure.NVIC_IRQChannel = TIM3_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
	NVIC_Init(&NVIC_InitStructure);
	
	
	//TIM3 ??????//1us
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3, ENABLE);
	tim.TIM_ClockDivision = TIM_CKD_DIV1;
	tim.TIM_CounterMode = TIM_CounterMode_Up;
	tim.TIM_Period =9999;
	tim.TIM_Prescaler = 71;
	//定时时间T计算公式
	//T=(TIM_Period+1)*(TIM_Prescaler+1)/TIMxCLK=(999+1)*(71+1)/72MHz=1000us 10ms
	tim.TIM_RepetitionCounter = 1;
	TIM_TimeBaseInit(TIM3, &tim);
	TIM_Cmd(TIM3, ENABLE);
	TIM_ITConfig(TIM3, TIM_IT_Update, ENABLE);
	//TIME3_DISABLE;
}

int count_test=0;
void TIM3_IRQHandler(void)
{
	if(TIM_GetITStatus(TIM3, TIM_IT_Update) == SET)
	{
		TIM_ClearFlag(TIM3, TIM_IT_Update); 
		count_test++;
		if(count_test>=30000)count_test=0;
		flag_sent_usart = 1;
	}
}





void Usart_send(void)
{
	int i = 0;
	int j = 1;
	send_buf[0]=0xFB;
	for(i=0;i<1;i++)
	{
			send_buf[j]=data_buf[i];
			j++;
	}
	Uartx_SendnBuf(USART2, send_buf, j);
}

void init_rcc()
{
  RCC_DeInit();
  RCC_HSICmd(ENABLE);
  while ( !RCC_GetFlagStatus(33) )
    ;
  FLASH_PrefetchBufferCmd(16);
  FLASH_SetLatency(FLASH_Latency_2);
  RCC_HCLKConfig(0);
  RCC_PCLK2Config(0);
  RCC_PCLK1Config(1024);
  RCC_PLLConfig(0, RCC_PLLMul_16);//APB1 32MHz          APB2 64MHz
  RCC_PLLCmd(ENABLE);
  while ( !RCC_GetFlagStatus(57) )
    ;
  RCC_SYSCLKConfig(2);//选择PLL作为系统时钟
	
  while ( RCC_GetSYSCLKSource() != 8 )
		;
}
void Key_init(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
	GPIO_Init(GPIOA,&GPIO_InitStructure);
	//GPIO_SetBits(GPIOA,GPIO_Pin_1);
	
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1|GPIO_Pin_5;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
	GPIO_Init(GPIOB,&GPIO_InitStructure);
//	GPIO_SetBits(GPIOB,GPIO_Pin_0);
//	GPIO_SetBits(GPIOB,GPIO_Pin_5);
}
void read_key(void)
{
	Key_1 = 1-((GPIOB->IDR>> 1) & 1);
	Key_2 = 1-((GPIOA->IDR>> 0) & 1);
	Key_3 = 0;//1-((GPIOB->IDR>> 5) & 1);
	
	if(Key_1+Key_2<=1)
	{
		if(Key_1==1&&Key_1_his==0)
		{
			Mode_Speed=0;
		}
		if(Key_2==1&&Key_2_his==0)
		{
			Mode_Speed++;
		}
		
		if(Mode_Speed>=3)Mode_Speed=3;
		else if(Mode_Speed<=0)Mode_Speed=0;
		
		Key_1_his=Key_1;
		Key_2_his=Key_2;
		//Key_3_his=Key_3;
	}
}

void dis_wangge(void)
{
	Display_CGRAM_16x16(2,1,P_hengxian);
	Display_CGRAM_16x16(2,1,P_hengxian);
	Display_CGRAM_16x16(2,2,P_hengxian);
	Display_CGRAM_16x16(2,3,P_hengxian);
	Display_CGRAM_16x16(2,4,P_hengxian);
	Display_CGRAM_16x16(2,5,P_T);
	Display_CGRAM_16x16(2,6,P_hengxian);
	Display_CGRAM_16x16(2,7,P_hengxian);
	Display_CGRAM_16x16(2,8,P_hengxian);
	Display_CGRAM_16x16(2,9,P_hengxian);
	Display_CGRAM_16x16(2,10,P_hengxian);
	Display_CGRAM_16x16(2,11,P_hengxian);
	Display_CGRAM_16x16(2,12,P_hengxian);
		
	Display_CGRAM_16x16(3,5,P_shuxian);
	Display_CGRAM_16x16(4,5,P_shuxian);
	Display_CGRAM_16x16(5,5,P_shuxian);
	Display_CGRAM_16x16(6,5,P_shuxian);
	Display_CGRAM_16x16(6,1,P_xiahengxian);
		
	Display_CGRAM_16x16(6,1,P_xiahengxian);
	Display_CGRAM_16x16(6,2,P_xiahengxian);
	Display_CGRAM_16x16(6,3,P_xiahengxian);
	Display_CGRAM_16x16(6,4,P_xiahengxian);
	Display_CGRAM_16x16(6,5,P_xiaT);
	Display_CGRAM_16x16(6,6,P_xiahengxian);
	Display_CGRAM_16x16(6,7,P_xiahengxian);
	Display_CGRAM_16x16(6,8,P_xiahengxian);
	Display_CGRAM_16x16(6,9,P_xiahengxian);
	Display_CGRAM_16x16(6,10,P_xiahengxian);
	Display_CGRAM_16x16(6,11,P_xiahengxian);
	Display_CGRAM_16x16(6,12,P_xiahengxian);
}

void dis_key(int Mode)
{
	switch(Mode)
	{
		case 1:
		{
			Display_CGRAM_16x16(3,2,Dangwei_1_1);
			Display_CGRAM_16x16(3,3,Dangwei_1_2);
			Display_CGRAM_16x16(4,2,Dangwei_1_3);
			Display_CGRAM_16x16(4,3,Dangwei_1_4);
			Display_CGRAM_16x16(5,2,Dangwei_1_5);
			Display_CGRAM_16x16(5,3,Dangwei_1_6);
			break;
		}
		case 2:
		{
			Display_CGRAM_16x16(3,2,Dangwei_2_1);
			Display_CGRAM_16x16(3,3,Dangwei_2_2);
			Display_CGRAM_16x16(4,2,Dangwei_2_3);
			Display_CGRAM_16x16(4,3,Dangwei_2_4);
			Display_CGRAM_16x16(5,2,Dangwei_2_5);
			Display_CGRAM_16x16(5,3,Dangwei_2_6);
			break;
		}
		case 3:
		{
			Display_CGRAM_16x16(3,2,Dangwei_3_1);
			Display_CGRAM_16x16(3,3,Dangwei_3_2);
			Display_CGRAM_16x16(4,2,Dangwei_3_3);
			Display_CGRAM_16x16(4,3,Dangwei_3_4);
			Display_CGRAM_16x16(5,2,Dangwei_3_5);
			Display_CGRAM_16x16(5,3,Dangwei_3_6);
			break;
		}
		default:
		{
			Display_CGRAM_16x16(3,2,Dangwei_0_1);
			Display_CGRAM_16x16(3,3,Dangwei_0_2);
			Display_CGRAM_16x16(4,2,Dangwei_0_3);
			Display_CGRAM_16x16(4,3,Dangwei_0_4);
			Display_CGRAM_16x16(5,2,Dangwei_0_5);
			Display_CGRAM_16x16(5,3,Dangwei_0_6);
			break;
		}
	}
}
void dis_power(int power)
{
	switch(power)
	{
		case 10:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_100);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
		  Display_CGRAM_16x16(1,11,dianliang_100);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 9:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_90);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
		  Display_CGRAM_16x16(1,11,dianliang_90);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 8:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_80);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
		  Display_CGRAM_16x16(1,11,dianliang_80);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 7:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_70);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
		  Display_CGRAM_16x16(1,11,dianliang_70);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 6:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_60);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
		  Display_CGRAM_16x16(1,11,dianliang_60);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 5:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_50);
		  Display_CGRAM_16x16(1,11,dianliang_50);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 4:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_40);
		  Display_CGRAM_16x16(1,11,dianliang_40);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 3:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_30);
		  Display_CGRAM_16x16(1,11,dianliang_30);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 2:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_20);
		  Display_CGRAM_16x16(1,11,dianliang_20);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 1:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_10);
		  Display_CGRAM_16x16(1,11,dianliang_10);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
		case 0:
		{
			Display_CGRAM_16x16(1,9,Dianchi_1_50_DOWN);
 		  Display_CGRAM_16x16(1,10,Dianchi_2_0);
		  Display_CGRAM_16x16(1,11,dianliang_0);
 		  Display_CGRAM_16x16(1,12,percent);
			break;
		}
	}
}
void dis_speed(int speed)
{
	switch(speed)
	{
		case 0:
		{
			display_char1(4,9,"5Km/H");
			break;
		}
		case 1:
		{
			display_char1(4,9,"10Km/H");
			break;
		}
		case 2:
		{
			display_char1(4,9,"20Km/H");
			break;
		}
		case 3:
		{
			display_char1(4,9,"30Km/H");
			break;
		}
		case 4:
		{
			display_char1(4,9,"40Km/H");
			break;
		}
	}
}


void Stop_init(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4|GPIO_Pin_5;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPD;
	GPIO_Init(GPIOA,&GPIO_InitStructure);
	//GPIO_SetBits(GPIOA,GPIO_Pin_1);
	
//	GPIO_SetBits(GPIOB,GPIO_Pin_0);
//	GPIO_SetBits(GPIOB,GPIO_Pin_5);
}

int count_stop = 0;


void read_stop(void)
{
	Stop_1 = ((GPIOA->IDR>> 4) & 1);
	Stop_2 = ((GPIOA->IDR>> 5) & 1);
	
	if(Stop_1+Stop_2>=1)
	{
		count_stop++;
		if(count_stop>=200)
			count_stop = 200;
		//Mode_Speed=0;
	}
	else
	{
		count_stop = 0;
	}
//	if(Key_1+Key_2<=1)
//	{
//		if(Key_1==1&&Key_1_his==0)
//		{
//			Mode_Speed=0;
//		}
//		if(Key_2==1&&Key_2_his==0)
//		{
//			Mode_Speed++;
//		}
//		
//		if(Mode_Speed>=3)Mode_Speed=3;
//		else if(Mode_Speed<=0)Mode_Speed=0;
//		
//		Key_1_his=Key_1;
//		Key_2_his=Key_2;
//	}
}



int test_power = 0;
int test_speed = 0;

int main(void)
{
	init_rcc();
	//NVIC_PriorityGroupConfig(NVIC_PriorityGroup_3);
	GPIO_Control_Init();			//IO初始化
	Timer_Config();

	
	UART2_init(115200);
	Key_init();
	Stop_init();
	
	
	LCD_port_init();
	initial_lcd();
	
	
	
	
	
	clear_screen();
	dis_wangge();
	dis_key(0);
	
		 
		 
	Display_CGRAM_16x16(1,9,Dianchi_1_100);
 	Display_CGRAM_16x16(1,10,Dianchi_2_50_UP);
	Display_CGRAM_16x16(1,11,dianliang_100);
 	Display_CGRAM_16x16(1,12,percent);
		 
	display_char1(4,6,"速度:");
	display_char1(4,9,"30Km/H");
		 
	while(1)
	{
		if(flag_sent_usart==1)//1ms一次
		{
			flag_sent_usart = 0;
			TIME3_DISABLE;
			//
			read_key();
			read_stop();
			if(count_stop>=10)
			{
				Mode_Speed=0;
			}
			
			if(Mode_Speed!=Mode_Speed_his)
			{
				CGRAM_order = 0;
				CGRAM_ADDRESS = 0x80;
				dis_wangge();
				dis_key(Mode_Speed);
				dis_power(test_power);
				dis_speed(test_speed);
			}
			Mode_Speed_his = Mode_Speed;
			
			power_level = test_power;//buf_rec_usart_2[0];
			if(power_level!=power_level_his)
			{
				CGRAM_order = 0;
				CGRAM_ADDRESS = 0x80;
				dis_wangge();
				dis_key(Mode_Speed);
				dis_power(test_power);
				dis_speed(test_speed);
			}
			power_level_his = power_level;
			
			speed_level = test_speed;//buf_rec_usart_2[1];
			if(speed_level!=speed_level_his)
			{
				CGRAM_order = 0;
				CGRAM_ADDRESS = 0x80;
				dis_wangge();
				dis_key(Mode_Speed);
				dis_power(test_power);
				dis_speed(test_speed);
			}
			speed_level_his = speed_level;

			data_buf[0] = Mode_Speed;
			Usart_send();
			TIME3_ENABLE;
		}
	}
}
